---
title: "Hw_5"
author: "IFEBUNANDU JEROME OKEKE"
date: "3/13/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

# Excercise 1. Using APIs
 - Pick a website of your choice (not discussed in class) that requires a free API key to download a data set. Convert elements of interest into a tibble and create a graph to answer a question of interest.

 - State the question and interpret the plot.

```{r}
library(keyring)
library(tidyverse)
library(httr)
library(jsonlite)
library(usethis)

```

##
##
## Data From The Movie Database(TMDB)

```{r}

movie_recomm <- GET(url = "https://api.themoviedb.org/3/movie/343611/recommendations?api_key=ec8181d2db5dadf144351e531527d2ac&language=en-US&page=1")

status_code(movie_recomm)

```
##
##
```{r}
is.raw(movie_recomm$content)
movie_recomm$content

```
##
##

Tidy and Clean Data.

```{r}

glimpse(content(movie_recomm, as = "text"))

top_movie <- content(movie_recomm, as = "text")

movie_selct <- fromJSON(top_movie, flatten = TRUE)

```
##
##

```{r}
best_movie <- movie_selct$results

```
##
##
# Question of Interest.

A. The question of interest is identify the movie with the highest vote count. The ggplot will be utilized for this analysis. 

```{r}

best_movie %>%
  ggplot(aes(x = vote_count, y = reorder(title, vote_count))) +
  geom_point()

```

**-** Our graph shows mission Impossible-rogue nation as the movie with the highest vote count. 

##

B. We can explore further analysis by creating a plot to ascertain the relationship between vote_count and popularity. 
 A linear model will be used to assess if there is there a meaningful relationship
 
```{r}

best_movie %>% 
  
  ggplot(aes(x = popularity, y = vote_count)) +
  
  geom_point() +
  
  geom_smooth(method = "lm", se = FALSE)

```
**-** Our plot shows that there is positive relationship between popularity and vote_count.

- Below is the summary output analysis

```{r}

best_movie_lm <- lm(vote_count ~ popularity, data = best_movie)

summary(best_movie_lm)

```

**-** Our model shows that popularity is not significant therefore has no relationship with the way votes are cast.
##
##

# Excercise 2

- IMDB has a list of the Oscar Best Picture Winners.
Scrape the following elements, convert the data into a tibble, tidy it, and clean it to answer the questions below:

.Number
.Title
.Year
.MPAA Rating
.Length in minutes
.Genre
.Star Rating
.Metascore Rating
.Gross Receipts

Convert the data into a tibble, tidy it, and clean it to answer the following questions:

1. Show a summary of the number of data elements for each movie that are not NA. Which two elements are missing the most from the movies?

2. Create a plot of the length of a film and its gross, color coded by rating. Show linear smoothers for each rating.
. Does MPAA rating matter?

3. Create a plot with a single Ordinary Least Squares smoothing line with no standard errors showing for predicting stars rating based on metacritic scores for those movies that have metacritic scores.
. Use a linear model to assess if there is there a meaningful relationship. Show the summary of the output and interpret in terms of the p-value and the adjusted R-Squared?

4. Use an appropriate plot to compare the gross receipts by MPAA rating.

. Which MPAA rating has the highest median gross receipts?

. Which R-rated movies are in the overall top 10 of gross receipts?

. Use one-way analysis of variance to assess the level of evidence for whether all ratings have the same mean gross receipts. Show the summary of the results and provide your interpretation of the results.


## Solutions:

```{r}
# Scrap the data

library(rvest)

IMDB_HTML <- read_html("https://www.imdb.com/search/title/?count=100&groups=oscar_best_picture_winners&sort=year%2Cdesc&ref_=nv_ch_osc")

```
##
##
```{r}

IMDBDATA <- html_nodes(IMDB_HTML, css = ".ghost~ .text-muted+ span , .favorable , .ratings-imdb-rating strong , .genre , .runtime , .certificate , .unbold , .lister-item-header a")

IMDBHTMLTEXT <- html_text(IMDBDATA)

length(IMDBHTMLTEXT)

```
##

```{r}

OSCAR_BESTPIC <- tibble(text = IMDBHTMLTEXT)

OSCAR_BESTPIC

```
##

Tidy the data.


```{r}
## get movie numbers and remove non-movie elements:
OSCAR_BESTPIC %>% 
  mutate(MOVIENUM = str_detect(text,"^\\d+\\.$")) -> OSCAR_BESTPIC
sum(OSCAR_BESTPIC$MOVIENUM)

```
##
```{r}
OSCAR_BESTPIC %>%
  
  mutate(POSITION = cumsum(MOVIENUM)) %>%
  
  filter(POSITION > 0) ->
  
  OSCAR_BESTPIC

```

##
##
Tidy and clean Data

```{r}

MOVIE_ELEMENTS <- (html_nodes(IMDB_HTML, 
                               css = ".lister-item-header a , .text-primary"))

RANKING_TEXT <- html_text(MOVIE_ELEMENTS)

RANKING_TEXT %>%
  
  tibble(text = RANKING_TEXT) %>%
  
  mutate(rownum = row_number(),
         
         iseven = rownum %% 2 == 0,
         
         movie = rep(1:93, each = 2)) %>%
  
select(-rownum) %>%
  
pivot_wider(names_from = iseven, values_from = text) %>%
  
select(-movie, "Rank" = "FALSE", movie = "TRUE") %>%
  
  mutate(Rank = parse_number(Rank)) ->
  
  MOVIERANK

```
##
##

```{r}

OSCAR_BESTPIC %>%
  mutate(TITLE = text %in% MOVIERANK$movie) ->
  OSCAR_BESTPIC

```
##
##
```{r}

OSCAR_BESTPIC %>% 
  mutate(YEAR = str_detect(text, "\\(\\d{4}\\)")) -> OSCAR_BESTPIC

OSCAR_BESTPIC %>% 
  count(YEAR)


```

##
```{r}

RATING <- c("G", "PG", "PG-13", "R", "NC-17", "GP", "Not Rated", "Passed", "Approved")

OSCAR_BESTPIC %>% 
  mutate(MPA_RATING = text %in% RATING) -> OSCAR_BESTPIC

OSCAR_BESTPIC %>% 
  count(MPA_RATING)

```

##
##
```{r}
OSCAR_BESTPIC %>% 
  mutate(LGTH_IN_MINS = str_detect(text, "(^\\d+)\\s(min$)")) -> OSCAR_BESTPIC

OSCAR_BESTPIC %>% 
  count(LGTH_IN_MINS)

```
##

```{r}

OSCAR_BESTPIC %>% 
  mutate(GENRE = str_detect(text, "^\\n")) -> OSCAR_BESTPIC 

OSCAR_BESTPIC %>% 
  count(GENRE)

```
##

```{r}

OSCAR_BESTPIC %>% 
  mutate(STAR_RATING = str_detect(text, "(^\\d{1})\\.(\\d{1}$)")) -> OSCAR_BESTPIC

OSCAR_BESTPIC %>% 
  count(STAR_RATING)

```
##
##
```{r}
OSCAR_BESTPIC %>% 
  mutate(METASCORE_RATING = str_detect(text, "(^\\d+\\s+$)")) -> OSCAR_BESTPIC 
  
OSCAR_BESTPIC %>% 
  count(METASCORE_RATING)

```
##

```{r}

OSCAR_BESTPIC %>% 
  mutate(GROSS_RECEIPTS = str_detect(text, "(^\\$\\d+)\\.(\\d+)M$")) -> OSCAR_BESTPIC 
  
OSCAR_BESTPIC %>% 
  count(GROSS_RECEIPTS)

```
##
##

```{r}

OSCAR_BESTPIC %>% 
  mutate(ELEMENTS = case_when(MOVIENUM ~ "Number",
                         TITLE ~ "Title",
                         YEAR ~ "Year",
                         MPA_RATING ~ "MPAARating",
                         LGTH_IN_MINS ~ "LengthinMinutes",
                         GENRE ~ "Genre",
                         STAR_RATING ~ "StarRating",
                         METASCORE_RATING ~ "MetascoreRating",
                         GROSS_RECEIPTS ~ "GrossReceipts")) %>% 
  select(ELEMENTS, text, POSITION) %>% 
  pivot_wider(names_from = ELEMENTS, values_from = text) -> NEW_OSCAR_BESTPIC

 NEW_OSCAR_BESTPIC
 
```
##
```{r}
# Clean the Data

NEW_OSCAR_BESTPIC %>% 
  
  mutate(Number = parse_number(Number),
         
         Year = parse_number(Year),
         
         `MPAARating` = parse_factor(`MPAARating`),
         
         `LengthinMinutes` = str_replace_all(`LengthinMinutes`, "(\\s)min", ""),
         
         `LengthinMinutes` = parse_number(`LengthinMinutes`),
         
         Genre = str_replace_all(Genre, "\\n", ""),
         
         Genre = str_squish(Genre),
         
         `StarRating` = parse_number(`StarRating`),
         
         `MetascoreRating` = parse_number(`MetascoreRating`),
         
         `GrossReceipts` = str_replace_all(`GrossReceipts`, "\\$", ""),
         
         `GrossReceipts` = str_replace_all(`GrossReceipts`, "(M$)", ""),
         
         `GrossReceipts` = parse_number(`GrossReceipts`),
         
         POSITION = NULL) ->    NEW_OSCAR_BESTPIC

NEW_OSCAR_BESTPIC

```
##
1. Show a summary of the number of data elements for each movie that are not NA. Which two elements are missing the most from the movies?

```{r}

Data_elements <- c("METASCORE_RATING", "MOVIENUM", "TITLE",
           "YEAR", "MPA_RATING", "LGTH_IN_MINS",
           "GENRE", "STAR_RATING", "GROSS_RECEIPTS")

OSCAR_BESTPIC %>% 
  
  group_by(METASCORE_RATING, MOVIENUM, TITLE,YEAR, MPA_RATING, LGTH_IN_MINS,
           GENRE, STAR_RATING, GROSS_RECEIPTS) %>%
  
  count() -> Element_summary


tibble(Data_elements, count =  Element_summary$n)

```
##
##
2. Create a plot of the length of a film and its gross, color coded by rating. Show linear smoother for each rating.
- Does MPAA rating matter?  

```{r}
NEW_OSCAR_BESTPIC %>% 
  filter(!is.na(GrossReceipts)) %>% 
  ggplot(aes(x = LengthinMinutes, y = GrossReceipts, color = MPAARating)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)


```

**-** MPAA Rating does matter. The plot above shows that PG-13 has the most rating but also has the most Gross Receipts. 

##

3. Create a plot with a single Ordinary Least Squares smoothing line with no standard errors showing for predicting stars rating based on metacritic scores for those movies that have metacritic scores. 
- Use a linear model to assess if there is there a meaningful relationship. Show the summary of the output and interpret in terms of the $p$-value and the adjusted R-Squared?

```{r}
NEW_OSCAR_BESTPIC %>% 
  
  filter(!is.na(MetascoreRating)) %>% 
  
  ggplot(aes(x = MetascoreRating, y = StarRating)) +
  
  geom_point() +
  
  geom_smooth(method = lm, se = FALSE)

```
**-** The plot shows that there is a positive relationship between Star Rating and Metascore Rating.  

##
- Summary output

```{r}

OSCAR_BESTPIC_LM <- lm(StarRating ~ MetascoreRating, data = NEW_OSCAR_BESTPIC)

summary(OSCAR_BESTPIC_LM)

```
**-** The $P-value$ is less than 0.05(default value). This shows that our model fits the data. However, Our model does not explain much of the variation of the data because of the low Adjusted R-squared and $P-value$ but it is significant(It is better than not to have a model).

##
4. Use an appropriate plot to compare the gross receipts by MPAA rating.
  + Which MPAA rating has the highest median gross receipts? 
  + Which R-rated movies are in the overall top 10 of gross receipts?
  + Use one-way analysis of variance to assess the level of evidence for whether all ratings have the same mean gross receipts. Show the summary of the results and provide your interpretation of the results.

```{r}

NEW_OSCAR_BESTPIC %>% 
  
  filter(!is.na(GrossReceipts)) %>% 
  
  ggplot(aes(x = MPAARating, y = GrossReceipts)) +
  
  geom_boxplot()

```
**-** The MPAA rating with the highest median gross receipts is the PG-13

##

- Which R-rated movies are in the overall top 10 of gross receipts?

```{r}

NEW_OSCAR_BESTPIC %>% 
  
  arrange(-GrossReceipts)

```
**-** Gladiator and Rain Man

##
##

Use one-way analysis of variance to assess the level of evidence for whether all ratings have the same mean gross receipts. Show the summary of the results and provide your interpretation of the results.

```{r}

summary(aov(StarRating ~ GrossReceipts, data = NEW_OSCAR_BESTPIC))

```
**-** Based on the P-value of 0.00933 which is less that the default p-value of 0.05, we can reject the hypothesis that all ratings have the same mean gross receipts. The test shows that all ratings have different mean gross receipts.



